#! /usr/bin/bash
#
# this is an "executable" which should run the compiler 
# '{self.cc} {options} {source_file}'
# Inputs: /path/to/program.c
# Outputs: /path/to/program (executable)

# Use last argument as filepath.
filepath=${!#}
# Strip the extension
base="${filepath%.*}"
echo "Compiling $base (.c)"

# Preprocess
gcc -E -P $base.c -o $base.i

rm -f $base.s

# if --lex or --parse, do not generate .s
if [[ $1 == '--lex' || $1 == '--parse' ]]; then
	java -classpath /mnt/c/Users/dplas/dev/adventofcompilers/bin com.plasstech.aocomp.driver.Java2C < $base.i > /dev/null || exit 1;
else
	java -classpath /mnt/c/Users/dplas/dev/adventofcompilers/bin com.plasstech.aocomp.driver.Java2C < $base.i > $base.s || exit 1;
	gcc $base.s -o $base;
fi

